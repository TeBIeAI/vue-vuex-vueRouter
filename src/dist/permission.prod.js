"use strict";var _router=_interopRequireDefault(require("./router")),_store=_interopRequireDefault(require("./store")),_nprogress=_interopRequireDefault(require("nprogress"));require("nprogress/nprogress.css");var _elementUi=require("element-ui"),_auth=require("@/utils/auth"),_user=require("@/api/user");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var whiteList=["/login"];_router.default.beforeEach(function(r,e,t){var o=(0,_auth.getToken)("token");if(_nprogress.default.start(),o)if("/login"===r.path)t({path:"/"}),_nprogress.default.done();else if(_store.default.getters.name)t();else try{(0,_user.getUserInfo)({token:o}).then(function(e){var r=e.userList;_store.default.commit("SET_NAME",r.name),_store.default.commit("SET_ROLES",r.roles)}).catch(function(e){console.log(e)}),t()}catch(e){_elementUi.Message.error(e||"Has Error"),t("/login?redirect=".concat(r.path))}else-1!==whiteList.indexOf(r.path)?t():(t("/login"),Nprogress.done())}),_router.default.afterEach(function(){_nprogress.default.done()});